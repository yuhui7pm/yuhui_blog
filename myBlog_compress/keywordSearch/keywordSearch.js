var flag=true;var firstLoad=8;var end;var addHeight;var dat;var keywordOfBlog;window.onload=()=>{keywordSearch()}function allLists(item){$('#articlesWrapper').append(`<div class="article ${item.id}"><div class="picture"style="background-image:url(/static/blogIcon/image_${item.author}_${item.createtime}.jpg)"></div><div class="artical_right"><div class="title">${item.title}</div><p class="articleDiscription"></p><div class="articleBottom"><span class="item"style="height:16px;line-height:16px"style="position:relative;"><img src='../img/home/label.svg'height="16px"style="position:absolute;"/><span style="margin-left:20px;text-align:left;display:inline-block;width:40px">${item.classification}</span></span><span class="item"class=""><span class="author iconfont">&#xe620;</span><span style="color:#00a67c">${item.author}</span></span><span class="item"><span class="time iconfont">&#xe60d;</span><span>${getMyDate(item.createtime)}</span></span><span class="item"><span class="observers iconfont">&#xe65d;</span><span style="color:#00a67c">${item.readers}浏览</span></span><span class="item"><span class="comments iconfont">&#xe613;</span><span style="color:#00a67c">${item.comments}评论</span></span></div></div></div></div>`);wrapEllipsis(item)}function addLists(item){$('#articlesWrapper').append(`<div class="article ${item.id}"><div class="picture"style="background-image:url(/static/blogIcon/image_${item.author}_${item.createtime}.jpg)"></div><div class="artical_right"><div class="title">${item.title}</div><p class="articleDiscription"></p><div class="articleBottom"><span class="item"style="height:16px;line-height:16px"style="position:relative;"><img src='../img/home/label.svg'height="16px"style="position:absolute;"/><span style="margin-left:20px;text-align:left;display:inline-block;width:40px">${item.classification}</span></span><span class="item"class=""><span class="author iconfont">&#xe620;</span><span style="color:#00a67c">${item.author}</span></span><span class="item"><span class="time iconfont">&#xe60d;</span><span>${getMyDate(item.createtime)}</span></span><span class="item"><span class="observers iconfont">&#xe65d;</span><span style="color:#00a67c">${item.readers}浏览</span></span><span class="item"><span class="comments iconfont">&#xe613;</span><span style="color:#00a67c">${item.comments}评论</span></span></div></div></div></div>`).hide().fadeIn(200);wrapEllipsis(item)}function getMyDate(str){var oDate=new Date(str),oYear=oDate.getFullYear(),oMonth=oDate.getMonth()+1,oDay=oDate.getDate(),oHour=oDate.getHours(),oMin=oDate.getMinutes(),oSen=oDate.getSeconds(),oTime=oYear+'-'+addZero(oMonth)+'-'+addZero(oDay)+' '+addZero(oHour)+':'+addZero(oMin)+':'+addZero(oSen);return oTime}function addZero(num){if(parseInt(num)<10){num='0'+num}return num}function lazyLoad(dat){var index=Math.ceil(datLength/firstLoad);if(datLength>firstLoad){$(window).scroll(()=>{var scrollTop=(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)-200;var articlesHeight=($('#articlesWrapper').height())-200;for(var j=1;j<index;j++){if((scrollTop>articlesHeight)&&flag){for(var k=0;k<firstLoad-1;k++){if(j*firstLoad+k<datLength-1){addLists(dat[j*firstLoad+k])}else{flag=false}}}}})}$('.bottomTip').html('我已经到底了~~~')}function detailClick(user){$(".article").on('click',function(){var articleClass=$(this).attr('class');var regId=/\d+/gi;var passageId=articleClass.match(regId);window.parent.location.href="./blogDetail.html?username="+user+"&blogId="+passageId})}function getUsername(){if(window.location.href.split('?username=').length>1){var user=window.location.href.split('?username=')[1].split('&')[0];return user}else{return"用户"}}function keywordSearch(){keywordOfBlog=decodeURI(window.location.href.split("?keyword=")[1]);$.ajax({url:'/api/blog/keywordSearch',type:'GET',dataType:'json',contentType:"application/json",data:({keyword:keywordOfBlog}),success:(result)=>{console.log(result)if(result.errNum==0){keywordBlogs=result.data;loadBlogs(keywordBlogs)}}})}function loadBlogs(datTemplate){datLength=Object.keys(datTemplate).length;end=datLength>firstLoad?firstLoad:datLength;for(var i=0;i<end-1;i++){allLists(datTemplate[i])}lazyLoad(datTemplate);detailClick(getUsername());if(datTemplate.userid.usernameAuto){$('.loginStatus').html('退出');$('.username').html(datTemplate.userid.usernameAuto)}}function wrapEllipsis(item){var context=item.introduction;var rowNum=35;if(context){var index=Math.ceil(context.length/rowNum);if(index>5){context=context.substring(0,rowNum*5-3)+'...';index=5}for(var i=0;i<index;i++){var end=context.length<(i+1)*rowNum?context.length:(i+1)*rowNum;var con=context.substring(i*rowNum,end);$('.'+item.id).find('.articleDiscription').append(con+'<br/>')}}}